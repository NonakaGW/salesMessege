<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>勤務状況メッセージ作成ツール</title>
  <link rel="icon" href="favicon.ico">
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      max-width: 800px;
      margin: 20px auto;
      padding: 0 16px;
      background: #f5f5f5;
      line-height: 1.6;
    }
    h1 { font-size: 1.4rem; margin-bottom: 12px; }
    .card {
      background: #fff;
      padding: 16px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.06);
      margin-bottom: 16px;
    }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 6px 4px; vertical-align: top; }
    th.name-col, td.name-col { width: 90px; white-space: nowrap; }
    th { text-align: left; font-size: 0.9rem; }
    .group {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      font-size: 0.9rem;
    }

    /* ボタン共通 */
    button, .copy-btn {
      border: none;
      border-radius: 999px;
      padding: 8px 16px;
      font-size: 0.9rem;
      cursor: pointer;
      background: #2563eb;
      color: #fff;
      box-shadow: 0 4px 0 rgba(0,0,0,0.2);
      transition: transform 0.08s ease, box-shadow 0.08s ease, background 0.15s;
    }

    button.secondary {
      background: #e5e7eb;
      color: #111827;
    }

    button:hover, .copy-btn:hover {
      transform: translateY(-1px);
    }

    button:active, .copy-btn:active {
      transform: translateY(2px);
      box-shadow: 0 1px 0 rgba(0,0,0,0.2);
    }

    textarea {
      width: 100%;
      min-height: 140px;
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #d1d5db;
      font-size: 0.9rem;
      resize: vertical;
    }
    .buttons {
      display: flex;
      gap: 8px;
      margin-top: 12px;
    }
    .copy-box {
      display: flex;
      justify-content: flex-end;
      margin-top: 8px;
    }
    .copy-btn {
      background: #10b981;
      font-size: 0.85rem;
    }
    input:disabled {
      opacity: 0.5;
    }
  </style>
</head>
<body>

<h1>教育部 勤務状況メッセージ作成ツール</h1>

<div class="card">
  <table>
    <thead>
      <tr>
        <th class="name-col">名前</th>
        <th>勤務区分</th>
        <th>時間帯オプション</th>
      </tr>
    </thead>
    <tbody id="rows"></tbody>
  </table>

  <div class="buttons">
    <button id="generate">作成</button>
    <button id="reset" class="secondary">リセット</button>
  </div>
</div>

<div class="card">
  <p>生成されたメッセージ：</p>
  <textarea id="output"></textarea>

  <div class="copy-box">
    <button class="copy-btn" id="copy">コピー</button>
  </div>
</div>

<script>
  const members = [
    { name: "菊地", default: "出社" },
    { name: "田村", default: "出社" },
    { name: "西山", default: "出社" },
    { name: "園部", default: "出社" },
    { name: "鹿嶋", default: "出社" },
    { name: "吉田(玲)", default: "出社" }
  ];

  function build() {
    const tbody = document.getElementById("rows");
    tbody.innerHTML = "";

    members.forEach((m, i) => {
      const baseStatuses = ["出社", "在宅", "休み", "その他"];

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td class="name-col">${m.name}</td>
        <td>
          <div class="group">
            ${baseStatuses
              .map(
                (b) => `
              <label>
                <input type="radio" name="base-${i}" value="${b}" ${
                  b === m.default ? "checked" : ""
                }>
                ${b}
              </label>`
              )
              .join("")}
          </div>
        </td>
        <td>
          <div class="group">
            <label><input type="checkbox" name="am-${i}"> 午前休</label>
            <label><input type="checkbox" name="pm-${i}"> 午後休</label>
          </div>
        </td>
      `;
      tbody.appendChild(tr);

      const baseRadios = tr.querySelectorAll(`input[name="base-${i}"]`);
      const am = tr.querySelector(`input[name="am-${i}"]`);
      const pm = tr.querySelector(`input[name="pm-${i}"]`);

      // ベースが休みなら午前休/午後休は無効化
      baseRadios.forEach((radio) => {
        radio.addEventListener("change", () => {
          if (radio.checked && radio.value === "休み") {
            am.checked = false;
            pm.checked = false;
            am.disabled = true;
            pm.disabled = true;
          } else {
            am.disabled = false;
            pm.disabled = false;
          }
        });
      });

      // 午前休/午後休はどちらか片方のみ
      am.addEventListener("change", () => {
        if (am.checked) pm.checked = false;
      });
      pm.addEventListener("change", () => {
        if (pm.checked) am.checked = false;
      });

      // 初期状態の反映
      const initial = [...baseRadios].find((r) => r.checked)?.value;
      if (initial === "休み") {
        am.disabled = true;
        pm.disabled = true;
      }
    });
  }

  function generate() {
    const result = { 出社: [], 在宅: [], 休み: [], その他: [] };

    members.forEach((m, i) => {
      const base = [...document.getElementsByName(`base-${i}`)].find(
        (r) => r.checked
      ).value;

      const amOff = document.querySelector(`input[name="am-${i}"]`).checked;
      const pmOff = document.querySelector(`input[name="pm-${i}"]`).checked;

      // amとpmが両方trueになることはUI上ないが、安全のため残す
      if (amOff && pmOff) {
        result["休み"].push(m.name);
      } else if (amOff) {
        result["休み"].push(`${m.name}(午前)`);
        result[base].push(`${m.name}(午後)`);
      } else if (pmOff) {
        result[base].push(`${m.name}(午前)`);
        result["休み"].push(`${m.name}(午後)`);
      } else {
        result[base].push(m.name);
      }
    });

    const lines = [
      "おはようございます。",
      "本日の教育部の勤務状況は下記のとおりです。",
      " "
    ];

    // 中身がある区分だけ出力（空なら行ごと出さない）
    const order = ["出社", "在宅", "休み", "その他"];
    order.forEach((key) => {
      if (result[key].length > 0) {
        lines.push(`${key}：${result[key].join("、")}`);
      }
    });

    document.getElementById("output").value = lines.join("\n");
  }

  function copyToClipboard() {
    const text = document.getElementById("output").value;
    if (!text) return;

    navigator.clipboard.writeText(text).then(() => {
      alert("コピーしました！");
    });
  }

  build();
  document.getElementById("generate").onclick = generate;
  document.getElementById("reset").onclick = () => {
    build();
    document.getElementById("output").value = "";
  };
  document.getElementById("copy").onclick = copyToClipboard;
</script>

</body>
</html>

